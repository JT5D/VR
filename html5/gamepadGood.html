<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <title>Gamepad, good</title>
</head>
<body onload="controllerTest()">
    <div id="output"></div>
    <script type="text/javascript" src="js/GamepadCommandInterface.js"></script>
    <script>
        function controllerTest() {
            "use strict";
            var output = document.getElementById("output"),
                frame = 0,
                pads = new GamepadCommandInterface([
                    { name: "horizontal", axes: [0], buttons: [-6, 7] },
                    { name: "jump", buttons: [0, 1, 2, 3], commandDown: jump },
                    { name: "fire", buttons: [5], commandDown: fire, dt: 250 }
                ]);

            function jump(id) {
                console.log(id, "jumped");
            }

            function fire(id) {
                console.log(id, "fired");
            }

            pads.addEventListener("gamepadconnected", function (id) {
                pads.addGamepad(id);
                console.log("connected");
            });
            pads.addEventListener("gamepaddisconnected", console.log.bind(console, "disconnected"));

            function loop(dt) {
                requestAnimationFrame(loop);
                pads.update();
                output.innerHTML = pads.getConnectedGamepads().map(function (id) {
                    return "<p>" + id + ": horiz (" + pads.getValue(id, "horizontal") + ")</p>";
                }).join("");
            }

            requestAnimationFrame(loop);
        }
    </script>
</body>

</html>